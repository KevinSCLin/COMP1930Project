<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title id="goalName"></title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/pastjournals_viewstyle.css">
    <link rel="stylesheet" href="css/navigationAndBackground.css">
    <script src="https://www.gstatic.com/firebasejs/7.3.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-firestore.js"></script>
    <script src="scripts/app.js"> var db=firebase.firestore();</script>
    <script src="scripts/loginverification.js"></script>
</head>
<body>
    <nav class=navbar navbar-expand navbar-dark flex-column flex-md-row bd-navbar style="background-color: #63E2E2; height:7.12%">
            <a class="nav-item nav-link active" id="home" href="main.html">Home</a>
            <a class="nav-item nav-link" id=journals href="journals.html">Journals</a>
            <a class="nav-item nav-link" id="goals" href="goals.html">Goals</a>
            <a class="nav-item nav-link" id="logoutbutton" href="index.html">Log Out</a>
    <h1 id="goalNameh1"></h1>
    <div id="JournalPlacement"></div>

<script>
    let queryString = decodeURIComponent(window.location.search);
    let URLsplitArr = queryString.split("?");
    let goalDoc = URLsplitArr[1];
    let goalName = URLsplitArr[2];
    document.getElementById("goalNameh1").innerHTML = goalName;
    let goalDocPath = db.collection("Users").doc(user).collection("Goals").doc(goalDoc).collection("Journals");
    let journalArr = [];
    let dateArr = [];

    //Retrieving all exising journals
    //:param date: key "date" in Firestore
    goalDocPath.orderBy("date", "desc")
    .get()
    .then(function(querySnapshot) {
        querySnapshot.forEach(function(doc) {
            console.log(doc.id, " => ", doc.data());
            journalArr.push(doc.data()["journalText"])
            dateArr.push(doc.data()["date"]);
        });
        for (i=0;i<journalArr.length;i++) {
            let currentDate = new Date(dateArr[i]);
            currentDate = currentDate.toString("MM/DD/YYYY")
            let newJournal = new createJournalParagraphs(currentDate, journalArr[i]);
            newJournal.createParagraph();
        }
    })
    .catch(function(error) {
        console.log("Error getting saved journals: ", error);
    })

    //Append journals to page
    //:param date: an int representing date in seconds
    //:param text: a string represent journal texts
    function createJournalParagraphs(date, text) {
        let newParagraph = document.createElement("p");
        newParagraph.setAttribute("class", "journalText");
        newParagraph.innerHTML = "<em>" + date + "</em>" + "<br><br>" + text;
        this.createParagraph = function () {
            document.getElementById("JournalPlacement").appendChild(newParagraph);
        };
    };
</script>


</body>
</html>