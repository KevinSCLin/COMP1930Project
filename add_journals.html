<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Add Journals</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/add_journalsstyle.css">
    <script src="https://www.gstatic.com/firebasejs/7.3.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-firestore.js"></script>
    <script src="scripts/app.js"> var db=firebase.firestore();</script>
    <script src="scripts/loginverification.js"></script>
</head>
<body>
    <nav class=navbar navbar-expand navbar-dark flex-column flex-md-row bd-navbar style="background-color: #63E2E2; height:7.12%">
            <a class="nav-item nav-link active" id="home" href="main.html">Home</a>
            <a class="nav-item nav-link" id=journals href="journals.html">Journals</a>
            <a class="nav-item nav-link" id="goals" href="goals.html">Goals</a>
            <a class="nav-item nav-link" id="settings" href="settings.html">Settings</a>
    </nav>
    <h2 id="text"></h2>
    
    <br><br><br>
    <div class="form-group">
        <label for="journalBox">Please enter your journal for this goal below:</label>
        <textarea class="form-control" id="journalValue" rows="12"></textarea>
    </div>
    <button id="submitJournal">Save</button>

    <script>
        // get goal docID
        let queryString = decodeURIComponent(window.location.search);
        let URLsplitArr = queryString.split("?");
        let docID = URLsplitArr[1];
        let journal = document.getElementById("journalValue");

        let goalDoc = db.collection("Users").doc(user).collection("Goals").doc(docID);
        let journalDoc = goalDoc.collection("Journals").doc("entry1");
        goalDoc.get().then(function(doc) {
            console.log(doc.data());
            let goalName = doc.data()["name"];
            console.log(goalName);
            document.getElementById("text").innerHTML = goalName;

        });
        journalDoc.get().then(function(doc) {
            journal.innerHTML = doc.data().journalText;
        });
        // Save button function
        let saveButton = document.getElementById("submitJournal");
        saveButton.onclick = function() {
            let journal = document.getElementById("journalValue").value;
            let journalDoc = goalDoc.collection("Journals").doc("entry1").set({
            journalText: journal,
            date: new Date().getTime()
            })
            .then(function() {
                console.log("Journal entry successfully saved!");
                window.location.href="journalsuccessfullyadded.html"
            })
            .catch(function(error) {
                console.error("Error saving journal entry: ", error);
            })

        }
    </script>
</body>
</html>