<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/subgoalsstyle.css">
    <script src="https://www.gstatic.com/firebasejs/7.3.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-firestore.js"></script>
    <script src="scripts/app.js"> var db=firebase.firestore();</script>
    <script src="scripts/loginverification.js"></script>
</head>
<body>
    <nav class=navbar navbar-expand navbar-dark flex-column flex-md-row bd-navbar style="background-color: #63E2E2; height:7.12%">
        <a class="nav-item nav-link active" id="home" href="main.html">Home</a>
        <a class="nav-item nav-link" id=journals href="journals.html">Journals</a>
        <a class="nav-item nav-link" id="goals" href="goals.html">Goals</a>
        <a class="nav-item nav-link" id="settings" href="settings.html">Settings</a>
    </nav>
    
    <div class="container">
      <a href="main.html"><button id="backbutton">Back</button></a>
    </div>

<script>
    var query = decodeURI(window.location.search);
    var queries = query.split("?");
    var goalID = queries[1];
    let index=0;
    let subgoalTotal=0;
    let subgoalsCompleted = 0;
    db.collection("Users").doc(user).collection("Goals").doc(goalID).collection("Subgoals").get().
    then( function (querySnapshot){
        querySnapshot.forEach(function(doc) {
            if (doc.data().name !== "") {
                subgoalTotal++;
                let div = document.createElement("div");
                let styleSheet = document.createElement("styleSheet");
                styleSheet.innerHTML = "#" + doc.id + "{top:" + (22.8 + 15 * index) + ";}";
                div.id = doc.id;
                div.innerHTML = doc.data().name;
                div.class = "subgoals";
                let inputEl = document.createElement("input");
                inputEl.id = doc.id + "checkbox";
                inputEl.type = "checkbox";
                if (doc.data().completed === true) {
                    inputEl.checked=true;
                }
                div.appendChild(inputEl);
                document.body.appendChild(div);
                document.head.appendChild(styleSheet);
                index++;
                inputEl.onclick = function () {
                    db.collection("Users").doc(user).collection("Goals").doc(goalID).collection("Subgoals").doc(doc.id).update({
                        completed: true,
                    })
                        .then(function () {
                            subgoalsCompleted++;
                            db.collection("Users").doc(user).collection("Goals").doc(goalID).update({
                                subgoals: subgoalTotal,
                                completedSubgoals: subgoalsCompleted,
                            })
                            console.log("true")
                        })
                }
            }
                })

            })




</script>
</body>
</html>